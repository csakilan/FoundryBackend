{
  "nodes": [
    {
      "id": {
        "_value": "ec2-1",
        "_inputType": "auto-generated",
        "_description": "Unique identifier for the node, automatically generated by the system"
      },
      "type": {
        "_value": "EC2",
        "_inputType": "fixed",
        "_description": "Resource type, fixed as EC2 for EC2 instances"
      },
      "position": {
        "_inputType": "auto-generated",
        "_description": "Canvas position, automatically managed by ReactFlow",
        "x": {
          "_value": -60,
          "_inputType": "auto-generated"
        },
        "y": {
          "_value": 100,
          "_inputType": "auto-generated"
        }
      },
      "data": {
        "label": {
          "_value": "EC2",
          "_inputType": "fixed",
          "_description": "Display label on the canvas node"
        },
        "name": {
          "_value": "web-01",
          "_inputType": "text",
          "_description": "Human-readable name for the EC2 instance (becomes the Name tag in AWS)",
          "_validation": {
            "required": true,
            "minLength": 1,
            "maxLength": 255,
            "pattern": "^[a-zA-Z0-9-_]+$"
          }
        },
        "imageId": {
          "_value": "Ubuntu",
          "_inputType": "choice",
          "_description": "Operating system image for the EC2 instance",
          "_choices": [
            "Amazon Linux",
            "Ubuntu",
            "Windows"
          ],
          "_note": "These friendly names are automatically mapped to the latest AWS AMI via SSM parameters"
        },
        "instanceType": {
          "_value": "t3.micro",
          "_inputType": "choice",
          "_description": "EC2 instance size/type determining CPU, memory, and network performance",
          "_choices": [
            "t3.micro",
            "t3.small",
            "c7i-flex.large",
            "m7i-flex.large"
          ],
          "_note": "t4g and r6g are ARM-based (Graviton) instances; ensure OS compatibility"
        },
        "keyName": {
          "_value": "my-keypair",
          "_inputType": "text",
          "_description": "Name of the SSH key pair for accessing the instance",
          "_validation": {
            "required": true
          },
          "_note": "This key pair must exist in your AWS account in the deployment region"
        },
        "storage": {
          "_description": "Root volume configuration for the EC2 instance",
          "rootVolumeSizeGiB": {
            "_value": 20,
            "_inputType": "number",
            "_description": "Size of the root EBS volume in gigabytes",
            "_validation": {
              "required": true,
              "min": 8,
              "max": 16384
            },
            "_default": 20,
            "_note": "Minimum size depends on the AMI (typically 8GB for Linux, 30GB for Windows)"
          },
          "rootVolumeType": {
            "_value": "gp3",
            "_inputType": "choice",
            "_description": "EBS volume type determining performance and cost",
            "_choices": [
              "gp3",
              "gp2",
              "io1",
              "io2"
            ],
            "_default": "gp3",
            "_note": "gp3 is recommended for most workloads (better price/performance than gp2)"
          },
          "deleteOnTermination": {
            "_value": true,
            "_inputType": "boolean",
            "_description": "Whether to delete the volume when the instance is terminated",
            "_default": true,
            "_note": "Set to false if you want to preserve data after instance deletion"
          }
        }
      },
      "measured": {
        "_inputType": "auto-generated",
        "_description": "Canvas node dimensions, automatically managed by ReactFlow",
        "width": {
          "_value": 40,
          "_inputType": "auto-generated"
        },
        "height": {
          "_value": 40,
          "_inputType": "auto-generated"
        }
      }
    }
  ],
  "edges": [],
  "viewport": {
    "x": 0,
    "y": 0,
    "zoom": 1
  },
  "_hardcodedValues": {
    "_description": "Values that are hardcoded in the CloudFormation template and cannot be modified by users",
    "global": {
      "AWSTemplateFormatVersion": {
        "_value": "2010-09-09",
        "_description": "CloudFormation template format version (AWS standard)"
      },
      "templateDescription": {
        "_value": "Foundry v1 - Single stack for EC2 (S3/RDS/DynamoDB to be added later)",
        "_description": "Human-readable description of the CloudFormation stack"
      }
    },
    "parameters": {
      "_description": "CloudFormation parameters that must be provided at deployment time",
      "VpcId": {
        "_type": "AWS::EC2::VPC::Id",
        "_description": "VPC where the instance will be launched (currently reserved for future use)"
      },
      "SubnetId": {
        "_type": "AWS::EC2::Subnet::Id",
        "_description": "Subnet where the instance will be launched (required at deployment)"
      },
      "SecurityGroupId": {
        "_type": "AWS::EC2::SecurityGroup::Id",
        "_description": "Security group to attach to the instance (required at deployment)"
      }
    },
    "ec2Instance": {
      "blockDevice": {
        "DeviceName": {
          "_value": "/dev/xvda",
          "_description": "Root device name for Linux HVM instances (standard for most AMIs)"
        }
      },
      "metadata": {
        "_note": "MetadataOptions removed due to Troposphere version compatibility",
        "_description": "IMDSv2 metadata options (HttpTokens, HttpEndpoint, HttpPutResponseHopLimit) are not included"
      }
    },
    "outputs": {
      "_description": "CloudFormation outputs automatically generated for each EC2 instance",
      "instanceId": {
        "_format": "{LogicalId}Id",
        "_description": "The EC2 instance ID"
      },
      "privateIp": {
        "_format": "{LogicalId}PrivateIp",
        "_description": "The private IP address of the instance"
      },
      "publicIp": {
        "_format": "{LogicalId}PublicIp",
        "_description": "The public IP address (blank if no public IP assigned)"
      },
      "nameTag": {
        "_format": "{LogicalId}NameTag",
        "_description": "The name tag value of the instance"
      }
    },
    "resourceNaming": {
      "logicalIdFormat": {
        "_value": "EC2{sanitizedNodeId}",
        "_description": "CloudFormation logical resource ID format (removes hyphens, colons, underscores from node ID)"
      }
    },
    "tagging": {
      "nameTag": {
        "_description": "Automatically set from the 'name' field in user configuration",
        "_source": "data.name"
      }
    },
    "userData": {
      "_value": null,
      "_inputType": "textarea",
      "_description": "Optional bash script to run when the instance first starts",
      "_validation": {
        "required": false
      },
      "_example": "#!/bin/bash\nyum update -y\nyum install -y httpd\nsystemctl start httpd",
      "_note": "Use for automated setup and configuration"
    }
  },
  "_metadata": {
    "version": "1.0.0",
    "resourceType": "AWS::EC2::Instance",
    "description": "Configuration example for EC2 instance node with detailed metadata about each field",
    "inputTypes": {
      "text": "Free-form text input from user",
      "textarea": "Multi-line text input from user",
      "number": "Numeric input from user",
      "boolean": "True/false toggle",
      "choice": "Dropdown/select from predefined options",
      "fixed": "Fixed value, not editable by user",
      "auto-generated": "Automatically generated by system"
    }
  }
}
